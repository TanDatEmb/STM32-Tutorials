PWM-Modes 
#include "stm32f4xx.h"

void PWM_Config(void) {
    RCC_APB1PeriphClockCmd(RCC_APB1Periph_TIM2, ENABLE);
    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);

    GPIO_InitTypeDef gpioInitStructure;
    gpioInitStructure.GPIO_Pin = GPIO_Pin_0;
    gpioInitStructure.GPIO_Mode = GPIO_Mode_AF;
    gpioInitStructure.GPIO_Speed = GPIO_Speed_100MHz;
    gpioInitStructure.GPIO_OType = GPIO_OType_PP;
    gpioInitStructure.GPIO_PuPd = GPIO_PuPd_UP;
    GPIO_Init(GPIOA, &gpioInitStructure);
    GPIO_PinAFConfig(GPIOA, GPIO_PinSource0, GPIO_AF_TIM2);

    TIM_TimeBaseInitTypeDef timerInitStructure;
    timerInitStructure.TIM_Prescaler = 16000 - 1;
    timerInitStructure.TIM_CounterMode = TIM_CounterMode_Up;
    timerInitStructure.TIM_Period = 1000 - 1;
    timerInitStructure.TIM_ClockDivision = TIM_CKD_DIV1;
    timerInitStructure.TIM_RepetitionCounter = 0;
    TIM_TimeBaseInit(TIM2, &timerInitStructure);

    TIM_OCInitTypeDef outputChannelInit;
    outputChannelInit.TIM_OCMode = TIM_OCMode_PWM1;
    outputChannelInit.TIM_OutputState = TIM_OutputState_Enable;
    outputChannelInit.TIM_Pulse = 500; // 50% duty cycle
    outputChannelInit.TIM_OCPolarity = TIM_OCPolarity_High;
    TIM_OC1Init(TIM2, &outputChannelInit);
    TIM_OC1PreloadConfig(TIM2, TIM_OCPreload_Enable);

    TIM_Cmd(TIM2, ENABLE);
}

int main(void) {
    SystemInit();
    PWM_Config();

    while (1) {
        // Vòng lặp chính
    }
}


#include "stm32f4xx.h"

void PWM_Config(void) {
    // Bật xung nhịp cho TIM2 và GPIOA
    RCC->APB1ENR |= RCC_APB1ENR_TIM2EN;
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN;

    // Cấu hình PA0 làm đầu ra PWM
    GPIOA->MODER |= GPIO_MODER_MODER0_1; // Chọn chế độ alternate function
    GPIOA->AFR[0] |= 0x01;               // AF1 cho TIM2_CH1

    // Cài đặt prescaler, auto-reload và compare value
    TIM2->PSC = 16000 - 1;  // Chia xung nhịp
    TIM2->ARR = 1000 - 1;   // Đếm từ 0 đến 999
    TIM2->CCR1 = 500;       // Giá trị so sánh (50% duty cycle)

    // Cấu hình PWM mode 1 cho kênh 1
    TIM2->CCMR1 |= TIM_CCMR1_OC1M_PWM1;
    TIM2->CCMR1 |= TIM_CCMR1_OC1PE;
    TIM2->CCER |= TIM_CCER_CC1E; // Bật kênh 1
    TIM2->CR1 |= TIM_CR1_ARPE;   // Bật preload register

    // Bật counter của TIM2
    TIM2->CR1 |= TIM_CR1_CEN;
}

int main(void) {
    // Khởi tạo hệ thống
    SystemInit();

    // Cấu hình PWM
    PWM_Config();

    while (1) {
        // Vòng lặp chính
    }
}

